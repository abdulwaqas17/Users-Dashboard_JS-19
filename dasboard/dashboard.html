<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- <link rel="stylesheet" href="dashboard.css"> -->
    <link rel="stylesheet" href="./../style.css" />
  </head>
  <body>
    <div class="dashboard flex">
      <!-- for mobile navbar  -->
      <div class="mobile-nav flex">
        <h2>Tech Inn</h2>
        <i class="fa-solid fa-bars toggle"></i>
      </div>

      <!-- dashboard left is here  -->
      <div class="leftBar">
        <!-- company logo is here  -->
        <div class="logo">
          <h2>Tech Inn</h2>
        </div>

        <!-- <a href="./../homepage/home.html"></a> -->
        <!-- links is here  -->
        <div class="links">
          <ul>
            <li onclick="showHome()" id="home">
              
              <a href="javascript:void(0)"><i class="fa-solid fa-house-user"></i>Home</a>
            </li>

            <li onclick="showDashboard()" style="background-color: var(--color2);" id="dashboard">
              <a href="javascript:void(0)"><i class="fa-solid fa-database"></i>Dashboard</a>
            </li>

            <li onclick="showProfile()" id="profile">
              <a href="javascript:void(0)"><i class="fa-solid fa-circle-user"></i>Profile</a>
            </li>

            <li onclick="showServices()" id="services">
              <a href="./../services/service.html"><i class="fa-solid fa-list-check"></i>Services</a>
            </li>

            <li onclick="showContact()" id="contact">
              <a href="./../contact/contact.html"><i class="fa-solid fa-envelope"></i>Contact Us</a>
            </li>
          </ul>
        </div>
      </div>

      <!-- dashboard Right is here  -->
      <div class="dashboardRight DashboardR">
        <div class="dashboardRightContainer">
          <!-- dashboardRightHeader is here  -->
          <div class="dashboardRightHeader">
            <div class="dashboardRightHeaderNav flex">
              <!-- dashboardRightHeaderHeading is here  -->
              <h2 class="dashboardRightHeaderHeading">USERS</h2>

              <!-- dashboardRightHeaderRightSide is here  -->
              <div class="dashboardRightHeaderRightSide flex">
                <div class="dashboardRightHeaderSearch flex">
                  <span><i class="fa-solid fa-magnifying-glass"></i></span>
                  <input type="text" placeholder="Search" />
                </div>

                <button
                  class="dashboardRightHeaderAddBtn"
                  onclick="againSignUp()"
                >
                  ADD USERS
                </button>

                <button class="dashboardRightHeaderInOf flex">
                  <span> • • • </span>
                </button>
              </div>
            </div>

            <!-- dashboardRightHeaderUsers is here  -->
            <div class="dashboardRightHeaderUsers">
              <ul class="flex userCount">
                <!-- <li><a href="#" id="totalUsers">All Users 235</a></li> -->
                <li class="flex">

                  <div class="Uicon">
                    <i class="fa-solid fa-users"></i>
                  </div>

                  <div class="textAndNum">
                    <h3><a href="#" id="totalUsers">0</a></h3>
                    <p>Total Users</p>
                  </div>

                </li>
                
                <li class="flex">

                  <div class="Uicon">
                    <i class="fa-solid fa-user-tie"></i>
                  </div>

                  <div class="textAndNum">
                    <h3><a href="#" id="totalAdmins">0</a></h3>
                    <p>Admins</p>
                  </div>

                </li>

                <li class="flex">

                  <div class="Uicon">
                    <i class="fa-solid fa-user-shield"></i>
                  </div>

                  <div class="textAndNum">
                    <h3><a href="#" id="totalManagers">0</a></h3>
                    <p>Managers</p>
                  </div>

                </li>

                <li class="flex">

                  <div class="Uicon">
                    <i class="fa-solid fa-user-group"></i>
                    <!-- <i class="fa-solid fa-user"></i> -->
                  </div>

                  <div class="textAndNum">
                    <h3><a href="#" id="totalEmployees">0</a></h3>
                    <p>Employees</p>
                  </div>

                </li>

                <!-- <li><a href="#" id="totalAdmins">Admins 35</a></li>

                <li><a href="#" id="totalManagers">Managers 50</a></li>

                <li><a href="#" id="totalEmployees">Employees 150</a></li> -->
              </ul>
            </div>
          </div>

          <!-- dashboardRightData is here  -->
          <div class="dashboardRightData">
            <table>
              <tr class="Tableheadings">
                <td>User Name</td>
                <td>User Email</td>
                <td>User City</td>
                <td colspan="2">User Type</td>
              </tr>

              <tbody id="trForUsers">
                 <tr>

                            <td>Muhammad Waqas</td>
                            <td>waqas123@gmail.com</td>
                            <td>Karachi</td>
                            <td colspan="2">Admin</td>

                        </tr>  

                        <tr>

                            <td>Zeeshan Ahmed</td>
                            <td>zeeshansd63@gmail.com</td>
                            <td>Lahore</td>
                            <td colspan="2">Manager</td>

                        </tr>

                        <tr>

                            <td>Nehal Qureshi</td>
                            <td>nehal80@gmail.com</td>
                            <td>Multan</td>
                            <td colspan="2">Employee</td>

                        </tr>

                        <tr>

                            <td>Abdullah</td>
                            <td>abdullah99@gmail.com</td>
                            <td>Quetta</td>
                            <td colspan="2">Admin</td>

                        </tr>

                        <!-- <tr>

                            <td>Muhammad Waqas</td>
                            <td>waqas123@gmail.com</td>
                            <td>Karachi</td>
                            <td>Admin</td>

                        </tr>  

                        <tr>

                            <td>Zeeshan Ahmed</td>
                            <td>zeeshansd63@gmail.com</td>
                            <td>Lahore</td>
                            <td>Manager</td>

                        </tr>

                        <tr>

                            <td>Nehal Qureshi</td>
                            <td>nehal80@gmail.com</td>
                            <td>Multan</td>
                            <td>Employe</td>

                        </tr>

                        <tr>

                            <td>Abdullah</td>
                            <td>abdullah99@gmail.com</td>
                            <td>Quetta</td>
                            <td>Admin</td>

                        </tr>  -->
              </tbody>

            </table>
          </div>
        </div>
      </div>
    </div>

    <script src="./../app.js"></script>

    <script>
      var totalAdmins = parseInt(window.localStorage.getItem("totalAdmin")) || 0;
      var totalManagers = parseInt(window.localStorage.getItem("totalManager")) || 0;
      var totalEmployees = parseInt(window.localStorage.getItem("totalEmployee")) || 0;

      console.log(totalAdmins, totalManagers, totalEmployees);

      document.getElementById("totalUsers").innerHTML = `
        
        ${totalAdmins + totalManagers + totalEmployees}`;

      document.getElementById("totalAdmins").innerHTML = `
        
        ${totalAdmins}`;

      document.getElementById("totalManagers").innerHTML = `
        
         ${totalManagers}`;

      document.getElementById("totalEmployees").innerHTML = `
        
        ${totalEmployees}`;

      // document.querySelector('.dashboardRightContainer').innerText = 'abc'
      // document.getElementById('abcd').innerHTML = 'Hello';

      // get tbody for inserting tr in it (storing the data)
      var trForUsers = document.getElementById("trForUsers");

      // get login email of current user from local Storage
      var currentUserEmail = window.localStorage.getItem("lastLoginUserEmail");
      console.log(currentUserEmail);

      // get current all users from local Storage
      var currentAllUsers = JSON.parse(window.localStorage.getItem("Users"));
      console.log(currentAllUsers);

      // get the obj of current user through its UNIQUE email
      for (var i = 0; i < currentAllUsers.length; i++) {
        if (currentUserEmail == currentAllUsers[i].userEmail) {
          // current user data store in this variable
          var currentUserData = currentAllUsers[i];
          console.log(currentUserData);
          break;
        }
      }

      console.log(currentUserData);
      // if current user is admin So,
      if (currentUserData.userRole == "Admin") {
        // loop for accessing all user data through iteration
        for (var j = 0; j < currentAllUsers.length; j++) {
          // shows all the data to admin (No condition for admin )
          trForUsers.innerHTML += `
                <tr>

                    <td>${currentAllUsers[j].userName}</td>
                    <td>${currentAllUsers[j].userEmail}</td>
                    <td>${currentAllUsers[j].userCity}</td>
                    <td>${currentAllUsers[j].userRole}</td>
                    <td id='deleteUser'><i class="fa-solid fa-trash-can"></i></td>
                    

                </tr> 
                `;
        }
      }
      // if current user is Manager
      else if (currentUserData.userRole == "Manager") {
        // loop for accessing all user data through iteration
        for (var k = 0; k < currentAllUsers.length; k++) {
          // for prevent to show Admin data to manager
          if (currentAllUsers[k].userRole !== "Admin") {
            trForUsers.innerHTML += `
                <tr>

                    <td>${currentAllUsers[k].userName}</td>
                    <td>${currentAllUsers[k].userEmail}</td>
                    <td>${currentAllUsers[k].userCity}</td>
                    <td>${currentAllUsers[k].userRole}</td>

                </tr>
                
                `;
          }
        }
      }
      // if current user is Employee
      else if (currentUserData.userRole == "Employee") {
        // loop for accessing all user data through iteration
        for (var l = 0; l < currentAllUsers.length; l++) {
          // for to show only employee data
          if (currentAllUsers[l].userRole == "Employee") {
            trForUsers.innerHTML += `
                <tr>

                    <td>${currentAllUsers[l].userName}</td>
                    <td>${currentAllUsers[l].userEmail}</td>
                    <td>${currentAllUsers[l].userCity}</td>
                    <td>${currentAllUsers[l].userRole}</td>

                </tr>

                `;
          }
        }
      }

      // i write this but By mistake bottom line work perfectly
      // var deleteUser = document.querySelectorAll('.deleteUser');

      // get parent of tr for deleting the tr and its userObj
      var deleteUser = document.getElementById("trForUsers");

      // make a function for delete user
      deleteUser.addEventListener("click", function (e) {
        // console.log(e.target.previousElementSibling.previousElementSibling.previousElementSibling);

        // get the email of desire users
        var deleteUserEmail =
          e.target.previousElementSibling.previousElementSibling
            .previousElementSibling.childNodes[0].nodeValue;
        // var deleteUserEmail = deletUsertd;
        console.log(deleteUserEmail);

        // get the allUsers form localStorage
        var allUsers = JSON.parse(window.localStorage.getItem("Users"));
        console.log(allUsers);

        // loop for get desire obj
        for (var i = 0; i < allUsers.length; i++) {
          // check if the email match
          if (deleteUserEmail == allUsers[i].userEmail) {
            var deleteUserObj = allUsers[i];
            // get the index no. of desire user for delete this
            var deleteUserIndex = i;

            console.log(deleteUserObj);
            console.log(deleteUserIndex);
            // break if the work is done
            break;
          }
        }

        // delete the user from array through splice
        if (deleteUserObj.userRole == "Admin") {
          var minusAdmin = parseInt(window.localStorage.getItem("totalAdmin"));
          minusAdmin = minusAdmin - 1;
          window.localStorage.setItem("totalAdmin", minusAdmin);
        } else if (deleteUserObj.userRole == "Manager") {
          var minusManager = parseInt(
            window.localStorage.getItem("totalManager")
          );
          minusManager = minusManager - 1;
          window.localStorage.setItem("totalManager", minusManager);
        } else if (deleteUserObj.userRole == "Employee") {
          var minusEmployee = parseInt(
            window.localStorage.getItem("totalEmployee")
          );
          minusEmployee = minusEmployee - 1;
          window.localStorage.setItem("totalEmployee", minusEmployee);
        }

        allUsers.splice(deleteUserIndex, 1);
        window.localStorage.setItem("Users", JSON.stringify(allUsers));
        alert(
          deleteUserObj.userName + " deleted successfully,"
        );
        location.reload();
      });

      // console.dir(trForUsers);
    </script>
  </body>
</html>
